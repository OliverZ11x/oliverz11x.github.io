---
date created: 2025/3/26 13:35
date modified: 2025/3/26 13:51
---

[索引数据流 | GraphRAG:中文文档教程，助力大模型LLM应用开发从入门到精通](https://www.graphrag.club/indexgraph/1-default_dataflow)

![[IMG-2025-03-26-13-42-40.png]]

- 从原始文本中提取实体、关系和主张
- 对实体进行社区检测
- 在多个粒度级别生成社区摘要和报告
- 将实体嵌入到图向量空间中
- 将文本块嵌入到文本向量空间中

### **第一阶段：组合 TextUnits**

**目标**：将文档分块，生成用于知识图谱提取的文本单元（TextUnit）。

- **TextUnit 定义**：一段待处理的文本片段，大小默认设置为 **300 个 token**，但在“glean”阶段可扩展到 **1200 个 token**。
- **分组逻辑**：
	- 默认情况下，TextUnit 与文档一对多映射，保证块之间不跨文档。
	- 在特殊情况下（如短文本集合），可以设置为多对多映射。
- **输出**：分块后的 TextUnits，准备进入下一阶段处理。

---

### **第二阶段：知识图谱提取**

**目标**：从 TextUnits 中提取**实体、关系和主张**，形成知识图谱基元。

- **实体和关系提取**：
	- 使用 LLM 从文本中提取：
		- **实体**：包括名称（name）、类型（type）、描述（description）。
		- **关系**：源实体（source）、目标实体（target）、关系描述（description）。
	- 合并逻辑：
		- 同名且同类型的实体合并，描述合并为数组。
		- 相同关系（source + target）合并，描述合并为数组。
- **实体解析（可选）**：
	- 检测表示同一现实世界对象但名称不同的实体。
	- 当前解析方式为**破坏性**合并（直接替换），未来版本将使用**无破坏性**解析（添加边）。
- **主张提取和发射**：
	- 提取正面事实陈述，包括时间范围和评估状态。
	- 以 **Covariate 表**形式发射，表示随时间变化的声明。

---

### **第三阶段：知识图谱增强**

**目标**：通过**社区检测**和**图谱嵌入**增强知识图谱。

- **社区检测**：
	- 使用 **层次 Leiden 算法**，对实体进行递归社区聚类
	- [From Louvain to Leiden: guaranteeing well-connected communities](https://arxiv.org/pdf/1810.08473)
	- 生成多层级社区，支持不同粒度的图谱分析。
- **图谱嵌入**：
	- 使用 **Node2Vec 算法**生成实体和关系的向量表示。
	- 支持在查询阶段进行**相似性搜索**。
- **输出**：
	- 增强后的实体和关系图谱，准备生成报告。

---

### **第四阶段：社区总结**

**目标**：生成社区报告，增强知识图谱的可解释性。

- **生成社区报告**：
	- 使用 LLM 为每个社区生成摘要，引用关键实体、关系和主张。
- **总结社区报告**：
	- LLM 对社区报告进行**摘要压缩**。
- **社区嵌入**：
	- 对社区报告生成向量嵌入，支持后续查询和搜索。
- **输出**：
	- 发射 **社区表**和**社区报告表**。

---

### **第五阶段：文档处理**

**目标**：将原始文档映射到知识模型中的文档表。

- **CSV 列扩充（可选）**：
	- 在处理 CSV 时，支持将原始表的其他字段映射到文档表中。
- **链接到文本单元**：
	- 将文档与 TextUnit 建立映射关系，便于追溯。
- **文档嵌入**：
	- 将文档切分为非重叠块，为每个块生成嵌入。
	- 采用 **加权平均法**生成文档级别的嵌入。
- **输出**：
	- 发射 **文档表**。

---

### **第六阶段：网络可视化**

**目标**：生成高维向量的 2D 可视化表示，便于图谱分析。

- **逻辑图**：
	- **实体关系图**
	- **文档图**
- **降维可视化**：
	- 使用 **UMAP 降维**生成 2D 表示。
	- 每个节点包括：
		- 节点类型（文档或实体）
		- UMAP 坐标
- **输出**：
	- 发射 **节点表**，支持可视化展示。

---

###  **整体流程图**

```python
文档 ➝ TextUnits ➝ 知识图谱提取 ➝ 增强 ➝ 总结 ➝ 文档处理 ➝ 网络可视化
```

每个阶段的输出包括实体、关系、主张、社区报告、文档表和可视化节点表。

嵌入和图谱增强支持高效查询与可视化分析。
